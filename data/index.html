<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M5StickC WiFi Debug Tool</title>
    <style>
        :root {
            /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
            --primary-color: #2196F3;
            --secondary-color: #0d47a1;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
            --error-color: #F44336;
            --bg-color: #f0f0f0;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #dddddd;
            --tab-active-bg: var(--primary-color);
            --tab-active-text: white;
            --tab-bg: #67baff;
            --tab-hover: #0061b0;
            --header-bg: var(--primary-color);
            --header-text: white;
            --card-shadow: 0 2px 4px rgba(0,0,0,0.1);
            --table-header-bg: #f2f2f2;
            --table-row-even: #f9f9f9;
            --table-row-hover: #f1f1f1;
            --disabled-color: #757575;
        }

        [data-theme="dark"] {
            /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
            --primary-color: #1976D2;
            --secondary-color: #1565C0;
            --success-color: #388E3C;
            --warning-color: #F57F17;
            --error-color: #C62828;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333333;
            --tab-active-bg: #1976D2;
            --tab-active-text: white;
            --tab-bg: #2c2c2c;
            --tab-hover: #3a3a3a;
            --header-bg: #1a1a1a;
            --header-text: white;
            --card-shadow: 0 2px 4px rgba(0,0,0,0.2);
            --table-header-bg: #2a2a2a;
            --table-row-even: #262626;
            --table-row-hover: #333333;
            --disabled-color: #505050;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 5px 5px 0 0;
            margin-bottom: 20px;
        }

        header h1 {
            margin: 0;
            font-size: 1.5rem;
        }

        .device-info {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
        }

        .device-info span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .device-info .indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .indicator.online {
            background-color: var(--success-color);
        }

        .indicator.offline {
            background-color: var(--error-color);
        }

        .tab {
            overflow: hidden;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            border-radius: 5px 5px 0 0;
            display: flex;
            justify-content: center;
        }

        .tab button {
            background-color: var(--tab-bg);
            border: none;
            outline: none;
            cursor: pointer;
            padding: 12px 16px;
            transition: 0.3s;
            font-size: 16px;
            border-radius: 5px 5px 0 0;
            color: var(--tab-active-text);
            flex: 1;
            text-align: center;
            max-width: 200px;
        }

        .tab button:hover {
            background-color: var(--tab-hover);
        }

        .tab button.active {
            background-color: var(--tab-active-bg);
            color: var(--tab-active-text);
        }

        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 5px 5px;
            background-color: var(--card-bg);
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .status-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid transparent;
        }

        .status-card.wifi {
            background-color: rgba(33, 150, 243, 0.1);
            border-left-color: var(--primary-color);
        }

        .status-card.ap {
            background-color: rgba(76, 175, 80, 0.1);
            border-left-color: var(--success-color);
        }

        .status-card h3 {
            margin: 0;
            font-size: 16px;
            color: var(--text-color);
        }

        .status-card.offline {
            background-color: rgba(244, 67, 54, 0.1);
            border-left-color: var(--error-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table, th, td {
            border: 1px solid var(--border-color);
        }

        th, td {
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: var(--table-header-bg);
            color: var(--text-color);
        }

        tr:nth-child(even) {
            background-color: var(--table-row-even);
        }

        tr:hover {
            background-color: var(--table-row-hover);
        }

        .network-list {
            max-height: 350px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        input[type="text"], 
        input[type="password"], 
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        input[type="text"]:focus, 
        input[type="password"]:focus, 
        input[type="number"]:focus,
        select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.25);
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--secondary-color);
        }

        button.secondary {
            background-color: var(--disabled-color);
        }

        button.secondary:hover {
            background-color: #616161;
        }

        button.success {
            background-color: var(--success-color);
        }

        button.success:hover {
            background-color: #388E3C;
        }

        button.warning {
            background-color: var(--warning-color);
            color: #333;
        }

        button.warning:hover {
            background-color: #FFA000;
        }

        button.danger {
            background-color: var(--error-color);
        }

        button.danger:hover {
            background-color: #D32F2F;
        }

        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid transparent;
        }

        .status.info {
            background-color: rgba(33, 150, 243, 0.1);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        .status.success {
            background-color: rgba(76, 175, 80, 0.1);
            border-left-color: var(--success-color);
            color: var(--success-color);
        }

        .status.warning {
            background-color: rgba(255, 193, 7, 0.1);
            border-left-color: var(--warning-color);
            color: var(--warning-color);
        }

        .status.error {
            background-color: rgba(244, 67, 54, 0.1);
            border-left-color: var(--error-color);
            color: var(--error-color);
        }

        .pin-card {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-bg);
            transition: box-shadow 0.3s;
        }

        .pin-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .pin-info {
            flex-grow: 1;
        }

        .pin-state {
            width: 60px;
            text-align: center;
            font-weight: bold;
            color: var(--text-color);
        }

        .pin-state.on {
            color: var(--success-color);
        }

        .pin-state.off {
            color: var(--error-color);
        }

        .pin-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pulse-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pulse-control input[type="number"] {
            width: 80px;
            padding: 5px;
            font-size: 14px;
        }

        .pulse-button {
            background-color: var(--warning-color);
            color: #333;
            padding: 8px 12px;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .toggle-btn {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 25px;
        }

        .toggle-btn input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 25px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 17px;
            width: 17px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success-color);
        }

        input:checked + .slider:before {
            transform: translateX(25px);
        }

        .loader {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .code-box {
            background-color: rgba(0, 0, 0, 0.1);
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin: 15px 0;
            font-family: "Courier New", monospace;
            line-height: 1.5;
            white-space: pre-wrap;
            overflow-x: auto;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .badge.success {
            background-color: var(--success-color);
            color: white;
        }

        .badge.warning {
            background-color: var(--warning-color);
            color: #333;
        }

        .badge.error {
            background-color: var(--error-color);
            color: white;
        }

        .badge.secondary {
            background-color: var(--disabled-color);
            color: white;
        }

        .signal-strength {
            display: inline-block;
            width: 20px;
            height: 15px;
            position: relative;
        }

        .signal-bar {
            width: 4px;
            background-color: #ccc;
            position: absolute;
            bottom: 0;
            border-radius: 1px 1px 0 0;
        }

        .signal-bar.bar1 {
            height: 3px;
            left: 0px;
        }

        .signal-bar.bar2 {
            height: 6px;
            left: 6px;
        }

        .signal-bar.bar3 {
            height: 9px;
            left: 12px;
        }

        .signal-bar.bar4 {
            height: 12px;
            left: 18px;
        }

        .signal-excellent .signal-bar {
            background-color: var(--success-color);
        }

        .signal-good .signal-bar.bar1,
        .signal-good .signal-bar.bar2,
        .signal-good .signal-bar.bar3 {
            background-color: var(--success-color);
        }

        .signal-fair .signal-bar.bar1,
        .signal-fair .signal-bar.bar2 {
            background-color: var(--warning-color);
        }

        .signal-weak .signal-bar.bar1 {
            background-color: var(--error-color);
        }

        .flex-container {
            display: flex;
            gap: 20px;
        }

        .flex-column {
            display: flex;
            flex-direction: column;
        }

        .flex-grow {
            flex-grow: 1;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .align-center {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .spacer {
            margin-top: 20px;
        }

        .divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 20px 0;
        }

        .text-center {
            text-align: center;
        }

        .progress-bar {
            height: 10px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress {
            height: 100%;
            background-color: var(--success-color);
            transition: width 0.3s;
        }

        .notification-area {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .notification {
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            animation: slideIn 0.3s forwards;
            max-width: 300px;
        }

        .notification.success {
            background-color: var(--success-color);
            color: white;
        }

        .notification.error {
            background-color: var(--error-color);
            color: white;
        }

        .notification.info {
            background-color: var(--primary-color);
            color: white;
        }

        .notification.warning {
            background-color: var(--warning-color);
            color: #333;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 15px;
        }

        .pagination button {
            width: 30px;
            height: 30px;
            padding: 0;
            text-align: center;
            border-radius: 4px;
            font-weight: bold;
        }

        /* Theme toggle button */
        .theme-toggle {
            margin-left: 10px;
            padding: 5px 10px;
            background-color: transparent;
            border: 1px solid var(--header-text);
            color: var(--header-text);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Styles for AP Users interface */
        .ap-users-list {
            margin-bottom: 20px;
        }

        .ap-user-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ap-user-info {
            flex-grow: 1;
        }

        .ap-user-controls {
            display: flex;
            gap: 10px;
        }

        .traffic-display {
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }
        
        [data-theme="dark"] .traffic-display {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .traffic-display .divider {
            margin: 10px 0;
            height: 1px;
            background-color: var(--border-color);
        }
        
        .traffic-display .packet-info {
            margin: 5px 0;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: 3px;
        }
        
        [data-theme="dark"] .traffic-display .packet-info {
            background-color: rgba(255, 255, 255, 0.02);
        }

        .user-details-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .user-details-section.hidden {
            display: none;
        }

        /* Pulse animation for scanning indicator */
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .scanning-indicator {
            animation: pulse 1.5s infinite ease-in-out;
            background-color: var(--warning-color);
            border-radius: 50%;
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 10px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .fade-out {
            animation: slideOut 0.3s forwards;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .device-info {
                flex-wrap: wrap;
            }

            .tab button {
                padding: 10px;
                font-size: 14px;
                max-width: none;
            }

            .flex-container {
                flex-direction: column;
            }

            .grid-container {
                grid-template-columns: 1fr;
            }

            .pin-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .pin-state {
                width: 100%;
                text-align: left;
            }

            .pin-controls {
                width: 100%;
                flex-wrap: wrap;
            }

            .pulse-control {
                width: 100%;
            }

            .pulse-control input[type="number"] {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>M5StickC WiFi Debugger</h1>
            <div class="device-info">
                <span id="wifi-indicator">
                    <span class="indicator offline"></span>
                    WiFi
                </span>
                <span id="ap-indicator">
                    <span class="indicator offline"></span>
                    AP
                </span>
                <span id="battery-indicator">–ë–∞—Ç–∞—Ä–µ—è: ...</span>
                <button id="theme-toggle" class="theme-toggle">
                    <span id="theme-icon">üåô</span>
                    <span id="theme-text">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
                </button>
            </div>
        </header>
        
        <div class="notification-area" id="notification-area">
            <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'status')">–°—Ç–∞—Ç—É—Å</button>
            <button class="tablinks" onclick="openTab(event, 'wifi')">Wi-Fi</button>
            <button class="tablinks" onclick="openTab(event, 'ap')">–¢–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞</button>
            <button class="tablinks" onclick="openTab(event, 'kvm')">KVM</button>
            <button class="tablinks" onclick="openTab(event, 'device')">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</button>
            <button class="tablinks" onclick="openTab(event, 'network')">–°–µ—Ç—å</button>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ -->
        <div id="status" class="tabcontent" style="display: block;">
            <h2>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h2>
            
            <div id="wifi-status" class="status-card wifi offline">
                <div>
                    <h3>–°—Ç–∞—Ç—É—Å WiFi</h3>
                    <div id="wifi-details">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
            
            <div id="ap-status" class="status-card ap offline">
                <div>
                    <h3>–°—Ç–∞—Ç—É—Å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞</h3>
                    <div id="ap-details">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
            
            <div class="card">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h3>
                <div class="flex-container">
                    <div class="flex-column flex-grow">
                        <p><strong>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</strong> M5StickC PLUS2</p>
                        <p><strong>–†–µ–∂–∏–º:</strong> <span id="operation-mode">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                        <p><strong>IP-–∞–¥—Ä–µ—Å:</strong> <span id="ip-address">-</span></p>
                    </div>
                    <div class="flex-column flex-grow">
                        <p>
                            <strong>–£—Ä–æ–≤–µ–Ω—å —Å–∏–≥–Ω–∞–ª–∞:</strong> 
                            <span id="signal-strength-container">
                                <span id="signal-strength-text">-</span>
                                <span id="signal-strength-indicator" class="signal-strength">
                                    <span class="signal-bar bar1"></span>
                                    <span class="signal-bar bar2"></span>
                                    <span class="signal-bar bar3"></span>
                                    <span class="signal-bar bar4"></span>
                                </span>
                            </span>
                        </p>
                        <p><strong>–ë–∞—Ç–∞—Ä–µ—è:</strong> <span id="battery-level">-</span></p>
                        <div id="battery-indicator-bar" class="progress-bar">
                            <div id="battery-progress" class="progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="spacer">
                <button onclick="refreshStatus()" class="primary">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ Wi-Fi -->
        <div id="wifi" class="tabcontent">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Wi-Fi</h2>
            
            <div class="card">
                <div class="form-group">
                    <button id="scan-wifi-btn" onclick="scanNetworks()" class="primary">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏</button>
                    <div class="loader" id="scan-loader"></div>
                    <div id="scan-status" style="margin-top: 10px; display: none;">
                        <span class="scanning-indicator"></span>
                        <span id="scan-status-text">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...</span>
                    </div>
                </div>
                
                <div class="network-list">
                    <table id="networks-table">
                        <thead>
                            <tr>
                                <th>SSID</th>
                                <th>–°–∏–≥–Ω–∞–ª</th>
                                <th>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</th>
                                <th>–ö–∞–Ω–∞–ª</th>
                                <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                            </tr>
                        </thead>
                        <tbody id="networks-list">
                            <tr>
                                <td colspan="5" class="text-center">–ù–∞–∂–º–∏—Ç–µ "–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∏" –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö WiFi —Å–µ—Ç–µ–π</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <h3>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏</h3>
                <form id="connect-form">
                    <div class="form-group">
                        <label for="ssid">SSID:</label>
                        <input type="text" id="ssid" name="ssid" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–µ—Ç–∏" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Å–µ—Ç–∏">
                    </div>
                    
                    <button type="submit" class="success">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
                </form>
            </div>
            
            <div class="card">
                <h3>–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ç–∏</h3>
                <div id="saved-networks-list">
                    <p class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π...</p>
                </div>
                <div class="spacer">
                    <button onclick="loadSavedNetworks()" class="primary">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ -->
        <div id="ap" class="tabcontent">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞</h2>
            
            <div class="card">
                <form id="ap-form">
                    <div class="form-group">
                        <label for="ap-mode">–†–µ–∂–∏–º:</label>
                        <select id="ap-mode" name="mode">
                            <option value="0">–í—ã–∫–ª—é—á–µ–Ω–æ</option>
                            <option value="1">–û–±—ã—á–Ω—ã–π</option>
                            <option value="2">–†–µ—Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä</option>
                            <option value="3">–°–∫—Ä—ã—Ç—ã–π</option>
                            <option value="4">Honeypot</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ap-ssid">SSID:</label>
                        <input type="text" id="ap-ssid" name="ssid" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞">
                    </div>
                    
                    <div class="form-group">
                        <label for="ap-password">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="ap-password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞">
                    </div>
                    
                    <div class="form-group">
                        <label for="ap-channel">–ö–∞–Ω–∞–ª:</label>
                        <select id="ap-channel" name="channel">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="success">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                </form>
            </div>
            
            <div class="card">
                <h3>–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                <div id="ap-users-list" class="ap-users-list">
                    <p class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
                </div>
                <div class="spacer">
                    <button onclick="loadAPUsers()" class="primary">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                </div>
            </div>
            
            <div id="honeypot-section" class="card" style="display: none; margin-top: 20px;">
                <h3>–õ–æ–≥–∏ Honeypot</h3>
                <button onclick="getHoneypotLogs()" class="primary">–û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏</button>
                
                <div id="honeypot-logs" class="spacer">
                    <p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ KVM -->
        <div id="kvm" class="tabcontent">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ KVM</h2>
            
            <div class="card">
                <h3>–ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–∏–Ω—ã</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="invert-pins" onchange="togglePinInversion()">
                        –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–∏–Ω–æ–≤ (0 = –í–ö–õ, 1 = –í–´–ö–õ)
                    </label>
                </div>
                <div id="pins-list">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–∏–Ω–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <p class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∏–Ω–æ–≤...</p>
                </div>
            </div>
            
            <div class="card">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–∏–Ω</h3>
                <form id="add-pin-form">
                    <div class="form-group">
                        <label for="pin-select">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∏–Ω:</label>
                        <select id="pin-select" name="pin" required>
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–∏–Ω --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="pin-name">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                        <input type="text" id="pin-name" name="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∏–Ω–∞" required>
                    </div>
                    
                    <button type="submit" class="success">–î–æ–±–∞–≤–∏—Ç—å –ø–∏–Ω</button>
                </form>
            </div>
            
            <div class="card">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h3>
                <form id="connection-check-form">
                    <div class="form-group">
                        <label for="connection-check">–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:</label>
                        <select id="connection-check" name="interval">
                            <option value="0">–í—ã–∫–ª—é—á–µ–Ω</option>
                            <option value="1">10 —Å–µ–∫—É–Ω–¥</option>
                            <option value="2">30 —Å–µ–∫—É–Ω–¥</option>
                            <option value="3">1 –º–∏–Ω—É—Ç–∞</option>
                            <option value="4">5 –º–∏–Ω—É—Ç</option>
                            <option value="5">30 –º–∏–Ω—É—Ç</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </form>
            </div>
            
            <div class="card">
                <h3>API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ curl</h3>
                <div class="code-box">
# –í–∫–ª—é—á–µ–Ω–∏–µ –ø–∏–Ω–∞
curl -X POST "http://{IP-–∞–¥—Ä–µ—Å}/api/kvm/pin?index=0&state=1"

# –í—ã–∫–ª—é—á–µ–Ω–∏–µ –ø–∏–Ω–∞
curl -X POST "http://{IP-–∞–¥—Ä–µ—Å}/api/kvm/pin?index=0&state=0"

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∏–Ω–∞
curl -X POST "http://{IP-–∞–¥—Ä–µ—Å}/api/kvm/pin?index=0"

# –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–º–ø—É–ª—å—Å–∞ –Ω–∞ –ø–∏–Ω
curl -X POST "http://{IP-–∞–¥—Ä–µ—Å}/api/kvm/pulse?index=0&duration=500"
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ -->
        <div id="device" class="tabcontent">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h2>
            
            <div class="card">
                <div id="device-details">
                    <p class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</p>
                </div>
            </div>
            
            <div class="card">
                <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
                <div class="flex-container">
                    <button onclick="findMe()" class="primary">–ù–∞–π—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</button>
                    <button onclick="resetDevice()" class="warning">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</button>
                </div>
                <p><small>–§—É–Ω–∫—Ü–∏—è "–ù–∞–π—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ" –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∑–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</small></p>
            </div>
            
            <div class="card">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h3>
                <form id="device-settings-form">
                    <div class="form-group">
                        <label for="brightness">–Ø—Ä–∫–æ—Å—Ç—å —ç–∫—Ä–∞–Ω–∞:</label>
                        <input type="range" id="brightness" name="brightness" min="0" max="100" value="80">
                        <span id="brightness-value">80%</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="sleep-timeout">–í—Ä–µ–º—è –¥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ —Å–ø—è—â–∏–π —Ä–µ–∂–∏–º:</label>
                        <select id="sleep-timeout" name="sleepTimeout">
                            <option value="0">–í—ã–∫–ª—é—á–µ–Ω–æ</option>
                            <option value="30">30 —Å–µ–∫—É–Ω–¥</option>
                            <option value="60">1 –º–∏–Ω—É—Ç–∞</option>
                            <option value="120">2 –º–∏–Ω—É—Ç—ã</option>
                            <option value="300">5 –º–∏–Ω—É—Ç</option>
                            <option value="600">10 –º–∏–Ω—É—Ç</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="device-id">–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</label>
                        <input type="text" id="device-id" name="deviceId" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞">
                    </div>
                    
                    <div class="form-group">
                        <label>–ü–æ–≤–æ—Ä–æ—Ç —ç–∫—Ä–∞–Ω–∞:</label>
                        <div class="align-center">
                            <input type="checkbox" id="rotate-display" name="rotateDisplay">
                            <label for="rotate-display" style="display: inline; margin-bottom: 0;">–í–∫–ª—é—á–∏—Ç—å –ø–æ–≤–æ—Ä–æ—Ç —ç–∫—Ä–∞–Ω–∞</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="volume">–ì—Ä–æ–º–∫–æ—Å—Ç—å:</label>
                        <input type="range" id="volume" name="volume" min="0" max="100" value="70">
                        <span id="volume-value">70%</span>
                    </div>
                    
                    <button type="submit" class="success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </form>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
        <div id="network" class="tabcontent">
            <h2>–°–µ—Ç–µ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h2>
            
            <div class="card">
                <h3>Ping</h3>
                <form id="ping-form">
                    <div class="form-group">
                        <label for="ping-host">–•–æ—Å—Ç/IP:</label>
                        <input type="text" id="ping-host" name="host" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 8.8.8.8" required>
                    </div>
                    
                    <button type="submit" class="primary">Ping</button>
                </form>
                <div id="ping-result" class="spacer"></div>
            </div>
            
            <div class="card">
                <h3>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–æ–≤</h3>
                <form id="ip-scan-form">
                    <div class="form-group">
                        <label for="ip-prefix">–ü—Ä–µ—Ñ–∏–∫—Å —Å–µ—Ç–∏:</label>
                        <input type="text" id="ip-prefix" name="prefix" placeholder="192.168.1" required>
                    </div>
                    
                    <button type="submit" class="primary">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>
                <div id="ip-scan-progress" style="display: none;">
                    <div class="progress-bar">
                        <div id="ip-scan-progress-bar" class="progress" style="width: 0%"></div>
                    </div>
                    <p id="ip-scan-status">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: 0/254</p>
                </div>
                <div id="ip-scan-result" class="spacer"></div>
            </div>
            
            <div class="card">
                <h3>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤</h3>
                <form id="port-scan-form">
                    <div class="form-group">
                        <label for="port-scan-ip">IP-–∞–¥—Ä–µ—Å:</label>
                        <input type="text" id="port-scan-ip" name="ip" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 192.168.1.1" required>
                    </div>
                    
                    <div class="flex-container">
                        <div class="form-group flex-grow">
                            <label for="port-scan-start">–ù–∞—á–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç:</label>
                            <input type="number" id="port-scan-start" name="startPort" value="1" min="1" max="65535" required>
                        </div>
                        
                        <div class="form-group flex-grow">
                            <label for="port-scan-end">–ö–æ–Ω–µ—á–Ω—ã–π –ø–æ—Ä—Ç:</label>
                            <input type="number" id="port-scan-end" name="endPort" value="1024" min="1" max="65535" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="primary">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—Ç—ã</button>
                </form>
                <div id="port-scan-result" class="spacer"></div>
            </div>
            
            <div id="ip-block-section" class="card">
                <h3>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∂–∏–º–∞ AP)</h3>
                <form id="ip-block-form">
                    <div class="form-group">
                        <label for="block-ip">IP –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</label>
                        <input type="text" id="block-ip" name="ip" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 192.168.4.2" required>
                    </div>
                    
                    <button type="submit" class="danger">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>
                <div class="spacer">
                    <h4>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞</h4>
                    <div id="blocked-ips">
                        <p>–ù–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentMode = '';
        let isAPModeActive = false;
        let isPinInverted = false;
        let currentUserIP = null;
        let sniffInterval = null;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∏–Ω–æ–≤
        function loadAvailablePins() {
            fetch('/api/kvm/available-pins')
                .then(response => response.json())
                .then(data => {
                    const pinSelect = document.getElementById('pin-select');
                    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫
                    while (pinSelect.options.length > 1) {
                        pinSelect.remove(1);
                    }
                    
                    data.pins.forEach(pin => {
                        const option = document.createElement('option');
                        option.value = pin.pin;
                        option.textContent = `${pin.name} - ${pin.description}`;
                        option.disabled = pin.inUse; // –û—Ç–∫–ª—é—á–∞–µ–º —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∏–Ω—ã
                        if (pin.inUse) {
                            option.textContent += ' (–í –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏)';
                        }
                        pinSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∏–Ω–æ–≤:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –ø–∏–Ω–æ–≤', 'error');
                });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
            applyTheme();
            
            refreshStatus();
            loadKVMPins();
            loadAvailablePins(); // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∏–Ω–æ–≤
            loadAPSettings();
            loadDeviceSettings();
            loadSavedNetworks();
            loadAPUsers();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è —Ç–µ–º—ã
            document.getElementById('theme-toggle').addEventListener('click', function() {
                toggleTheme();
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–æ–≤
            document.getElementById('brightness').addEventListener('input', function() {
                document.getElementById('brightness-value').textContent = this.value + '%';
            });
            
            document.getElementById('volume').addEventListener('input', function() {
                document.getElementById('volume-value').textContent = this.value + '%';
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ñ–æ—Ä–º
            document.getElementById('connect-form').addEventListener('submit', function(e) {
                e.preventDefault();
                connectToNetwork();
            });
            
            document.getElementById('add-pin-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewPin();
            });
            
            document.getElementById('ap-form').addEventListener('submit', function(e) {
                e.preventDefault();
                updateAPSettings();
            });
            
            document.getElementById('connection-check-form').addEventListener('submit', function(e) {
                e.preventDefault();
                updateConnectionCheck();
            });
            
            document.getElementById('ping-form').addEventListener('submit', function(e) {
                e.preventDefault();
                pingHost();
            });
            
            document.getElementById('ip-scan-form').addEventListener('submit', function(e) {
                e.preventDefault();
                scanIPRange();
            });
            
            document.getElementById('port-scan-form').addEventListener('submit', function(e) {
                e.preventDefault();
                scanPorts();
            });
            
            document.getElementById('ip-block-form').addEventListener('submit', function(e) {
                e.preventDefault();
                blockIP();
            });
            
            document.getElementById('device-settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveDeviceSettings();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ AP
            document.getElementById('ap-mode').addEventListener('change', function(e) {
                const honeypotSection = document.getElementById('honeypot-section');
                if (e.target.value === '4') { // Honeypot mode
                    honeypotSection.style.display = 'block';
                } else {
                    honeypotSection.style.display = 'none';
                }
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∏–Ω–æ–≤
            fetch('/settings/pin-inversion')
                .then(response => response.json())
                .then(data => {
                    isPinInverted = data.inverted;
                    document.getElementById('invert-pins').checked = isPinInverted;
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∏–Ω–æ–≤:', error);
                });
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            setInterval(refreshStatus, 30000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        });

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        function toggleTheme() {
            const theme = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –∏ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            if (theme === 'dark') {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
        function applyTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –∏ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            if (savedTheme === 'dark') {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–º–ø—É–ª—å—Å–∞ –Ω–∞ –ø–∏–Ω
        function sendPulseToPin(pinIndex, duration) {
            if (!duration) {
                duration = document.querySelector(`#pin-pulse-duration-${pinIndex}`).value;
            }
            
            fetch('/api/kvm/pulse', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `index=${pinIndex}&duration=${duration}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(`–ò–º–ø—É–ª—å—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø–∏–Ω (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${duration} –º—Å)`, 'success');
                } else {
                    showNotification(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–º–ø—É–ª—å—Å–∞: ${data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–º–ø—É–ª—å—Å–∞ –Ω–∞ –ø–∏–Ω:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–º–ø—É–ª—å—Å–∞ –Ω–∞ –ø–∏–Ω', 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∏–Ω–æ–≤
        function togglePinInversion() {
            const inverted = document.getElementById('invert-pins').checked;
            
            fetch('/settings/pin-inversion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `inverted=${inverted ? 1 : 0}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    isPinInverted = inverted;
                    showNotification(`–†–µ–∂–∏–º –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∏–Ω–æ–≤ ${inverted ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`, 'success');
                    loadKVMPins(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–∏–Ω—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞
                    document.getElementById('invert-pins').checked = isPinInverted;
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∏–Ω–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∏–Ω–æ–≤', 'error');
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞
                document.getElementById('invert-pins').checked = isPinInverted;
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π
        function loadSavedNetworks() {
            const savedNetworksList = document.getElementById('saved-networks-list');
            savedNetworksList.innerHTML = '<p class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π...</p>';
            
            fetch('/wifi/saved')
                .then(response => response.json())
                .then(data => {
                    if (data.networks && data.networks.length > 0) {
                        let html = '<table>';
                        html += '<thead><tr><th>SSID</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>';
                        
                        data.networks.forEach(network => {
                            html += `<tr>
                                <td>${network.ssid}</td>
                                <td>
                                    <button onclick="connectToSavedNetwork('${network.ssid}')" class="success">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
                                    <button onclick="deleteSavedNetwork('${network.ssid}')" class="danger">–£–¥–∞–ª–∏—Ç—å</button>
                                </td>
                            </tr>`;
                        });
                        
                        html += '</tbody></table>';
                        savedNetworksList.innerHTML = html;
                    } else {
                        savedNetworksList.innerHTML = '<p class="text-center">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π</p>';
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π:', error);
                    savedNetworksList.innerHTML = '<p class="text-center">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π</p>';
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π', 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Ç–∏
        function connectToSavedNetwork(ssid) {
            showNotification(`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ ${ssid}...`, 'info');
            
            fetch('/wifi/connect', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `ssid=${encodeURIComponent(ssid)}`
            })
            .then(response => response.text())
            .then(result => {
                showNotification(`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ ${ssid} –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ`, 'success');
                
                // –ñ–¥–µ–º –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                setTimeout(refreshStatus, 5000);
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Ç–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Ç–∏', 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Ç–∏
        function deleteSavedNetwork(ssid) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–µ—Ç—å "${ssid}"?`)) {
                fetch('/wifi/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `ssid=${encodeURIComponent(ssid)}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(`–°–µ—Ç—å ${ssid} —É–¥–∞–ª–µ–Ω–∞`, 'success');
                        loadSavedNetworks();
                    } else {
                        showNotification(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Ç–∏: ${data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Ç–∏:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Ç–∏', 'error');
                });
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            const notificationArea = document.getElementById('notification-area');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            notificationArea.appendChild(notification);
            
            // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–∫–∏
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ –¥–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤–∫–ª–∞–¥–∫–∞—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
            if (tabName === 'status') {
                refreshStatus();
            } else if (tabName === 'kvm') {
                loadKVMPins();
                loadAvailablePins();
            } else if (tabName === 'ap') {
                loadAPSettings();
                loadAPUsers();
            } else if (tabName === 'device') {
                loadDeviceSettings();
                loadDeviceInfo();
            } else if (tabName === 'network') {
                checkNetworkTools();
            } else if (tabName === 'wifi') {
                loadSavedNetworks();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function refreshStatus() {
            fetch('/diagnostic')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                })
                .then(data => {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞—Ç—É—Å–µ WiFi
                    const wifiStatus = document.getElementById('wifi-status');
                    const wifiDetails = document.getElementById('wifi-details');
                    const ipAddress = document.getElementById('ip-address');
                    const signalStrength = document.getElementById('signal-strength-text');
                    const signalIndicator = document.getElementById('signal-strength-indicator');
                    const operationMode = document.getElementById('operation-mode');
                    const batteryLevel = document.getElementById('battery-level');
                    const wifiIndicator = document.getElementById('wifi-indicator').querySelector('.indicator');
                    
                    if (data.connected) {
                        wifiStatus.classList.remove('offline');
                        wifiIndicator.classList.remove('offline');
                        wifiIndicator.classList.add('online');
                        
                        wifiDetails.innerHTML = `–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ç–∏: <strong>${data.ssid}</strong><br>–£—Ä–æ–≤–µ–Ω—å —Å–∏–≥–Ω–∞–ª–∞: ${data.rssi} dBm`;
                        ipAddress.textContent = data.ip;
                        signalStrength.textContent = `${data.rssi} dBm`;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–∞
                        signalIndicator.className = 'signal-strength';
                        if (data.rssi > -50) {
                            signalIndicator.classList.add('signal-excellent');
                        } else if (data.rssi > -70) {
                            signalIndicator.classList.add('signal-good');
                        } else if (data.rssi > -80) {
                            signalIndicator.classList.add('signal-fair');
                        } else {
                            signalIndicator.classList.add('signal-weak');
                        }
                        
                        operationMode.textContent = '–ö–ª–∏–µ–Ω—Ç';
                        operationMode.className = 'badge success';
                        currentMode = 'client';
                    } else {
                        wifiStatus.classList.add('offline');
                        wifiIndicator.classList.remove('online');
                        wifiIndicator.classList.add('offline');
                        
                        wifiDetails.innerHTML = '<strong>–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ WiFi</strong>';
                        ipAddress.textContent = '-';
                        signalStrength.textContent = '-';
                        signalIndicator.className = 'signal-strength';
                        operationMode.textContent = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                        operationMode.className = '';
                        currentMode = 'unknown';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ—á–∫–µ –¥–æ—Å—Ç—É–ø–∞
                    const apStatus = document.getElementById('ap-status');
                    const apDetails = document.getElementById('ap-details');
                    const apIndicator = document.getElementById('ap-indicator').querySelector('.indicator');
                    
                    if (data.ap_mode !== undefined && data.ap_mode > 0) {
                        apStatus.classList.remove('offline');
                        apIndicator.classList.remove('offline');
                        apIndicator.classList.add('online');
                        
                        let apModeName = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                        switch(data.ap_mode) {
                            case 1: apModeName = '–û–±—ã—á–Ω—ã–π'; break;
                            case 2: apModeName = '–†–µ—Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä'; break;
                            case 3: apModeName = '–°–∫—Ä—ã—Ç—ã–π'; break;
                            case 4: apModeName = 'Honeypot'; break;
                        }
                        
                        apDetails.innerHTML = `
                            –†–µ–∂–∏–º: <strong>${apModeName}</strong><br>
                            SSID: <strong>${data.ap_ssid}</strong><br>
                            IP: ${data.ap_ip}<br>
                            –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${data.ap_stations}
                        `;
                        
                        isAPModeActive = true;
                        
                        // –ï—Å–ª–∏ –º—ã –≤ —Ä–µ–∂–∏–º–µ AP, –æ–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IP
                        document.getElementById('ip-block-section').style.display = 'block';
                        loadBlockedIPs();
                    } else {
                        apStatus.classList.add('offline');
                        apIndicator.classList.remove('online');
                        apIndicator.classList.add('offline');
                        
                        apDetails.innerHTML = '<strong>–¢–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞</strong>';
                        isAPModeActive = false;
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IP, –µ—Å–ª–∏ AP –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
                        document.getElementById('ip-block-section').style.display = 'none';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞—Ç–∞—Ä–µ–µ
                    if (data.battery) {
                        const batteryVoltage = data.battery.toFixed(2);
                        batteryLevel.textContent = `${batteryVoltage}V`;
                        document.getElementById('battery-indicator').textContent = `–ë–∞—Ç–∞—Ä–µ—è: ${batteryVoltage}V`;
                        
                        // –†–∞—Å—á–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –∑–∞—Ä—è–¥–∞ (–¥–ª—è M5StickC PLUS 2)
                        // 4.2V - 100%, 3.0V - 0%
                        let batteryPercent = Math.min(100, Math.max(0, (data.battery - 3.0) / 1.2 * 100));
                        document.getElementById('battery-progress').style.width = batteryPercent.toFixed(0) + '%';
                        
                        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞—Ä—è–¥–∞
                        if (batteryPercent < 20) {
                            document.getElementById('battery-progress').style.backgroundColor = 'var(--error-color)';
                        } else if (batteryPercent < 50) {
                            document.getElementById('battery-progress').style.backgroundColor = 'var(--warning-color)';
                        } else {
                            document.getElementById('battery-progress').style.backgroundColor = 'var(--success-color)';
                        }
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: ' + error.message, 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ç–µ–π —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞
        function scanNetworks() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            const scanButton = document.getElementById('scan-wifi-btn');
            const scanStatus = document.getElementById('scan-status');
            const scanStatusText = document.getElementById('scan-status-text');
            
            scanButton.disabled = true;
            scanStatus.style.display = 'block';
            scanStatusText.textContent = '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...';
            
            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫
            const networksList = document.getElementById('networks-list');
            networksList.innerHTML = '<tr><td colspan="5" class="text-center">–ó–∞–ø—É—Å–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...</td></tr>';
            
            // –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            fetch('/scan-start')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                })
                .then(data => {
                    networksList.innerHTML = '<tr><td colspan="5" class="text-center">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...</td></tr>';
                    scanStatusText.textContent = '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
                    
                    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                    function checkScanStatus() {
                        fetch('/scan-status')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                                }
                                return response.json();
                            })
                            .then(statusData => {
                                if (statusData.status === 'scanning') {
                                    // –ï—Å–ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å—ë –µ—â–µ –∏–¥–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                                    scanStatusText.textContent = '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
                                    setTimeout(checkScanStatus, 1000);
                                } else if (statusData.status === 'ready') {
                                    // –ï—Å–ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                    scanStatusText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...';
                                    getNetworkResults();
                                } else {
                                    // –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å
                                    networksList.innerHTML = '<tr><td colspan="5" class="text-center">–û—à–∏–±–∫–∞: –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</td></tr>';
                                    scanButton.disabled = false;
                                    scanStatus.style.display = 'none';
                                    showNotification('–û—à–∏–±–∫–∞: –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                                }
                            })
                            .catch(error => {
                                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                                networksList.innerHTML = '<tr><td colspan="5" class="text-center">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</td></tr>';
                                scanButton.disabled = false;
                                scanStatus.style.display = 'none';
                                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
                            });
                    }
                    
                    // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å
                    if (data.status === 'started' || data.status === 'scanning') {
                        setTimeout(checkScanStatus, 1000);
                    } else if (data.status === 'ready') {
                        // –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–∂–µ –≥–æ—Ç–æ–≤—ã, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏—Ö —Å—Ä–∞–∑—É
                        getNetworkResults();
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                    networksList.innerHTML = '<tr><td colspan="5" class="text-center">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</td></tr>';
                    scanButton.disabled = false;
                    scanStatus.style.display = 'none';
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
                });
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            function getNetworkResults() {
                fetch('/scan-results')
                    .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                    })
                    .then(data => {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π
                    networksList.innerHTML = '';
                    
                    if (data.networks && data.networks.length > 0) {
                        data.networks.forEach(network => {
                        const row = document.createElement('tr');
                        
                        // SSID
                        const ssidCell = document.createElement('td');
                        ssidCell.textContent = network.ssid || '(–°–∫—Ä—ã—Ç–∞—è —Å–µ—Ç—å)';
                        row.appendChild(ssidCell);
                        
                        // –°–∏–≥–Ω–∞–ª —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º
                        const rssiCell = document.createElement('td');
                        const signalDiv = document.createElement('div');
                        signalDiv.className = 'align-center';
                        
                        const signalText = document.createElement('span');
                        signalText.textContent = `${network.rssi} dBm`;
                        
                        const signalIndicator = document.createElement('span');
                        signalIndicator.className = 'signal-strength';
                        
                        for (let i = 1; i <= 4; i++) {
                            const bar = document.createElement('span');
                            bar.className = `signal-bar bar${i}`;
                            signalIndicator.appendChild(bar);
                        }
                        
                        if (network.rssi > -50) {
                            signalIndicator.classList.add('signal-excellent');
                        } else if (network.rssi > -70) {
                            signalIndicator.classList.add('signal-good');
                        } else if (network.rssi > -80) {
                            signalIndicator.classList.add('signal-fair');
                        } else {
                            signalIndicator.classList.add('signal-weak');
                        }
                        
                        signalDiv.appendChild(signalText);
                        signalDiv.appendChild(signalIndicator);
                        rssiCell.appendChild(signalDiv);
                        row.appendChild(rssiCell);
                        
                        // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
                        const securityCell = document.createElement('td');
                        const securitySpan = document.createElement('span');
                        securitySpan.textContent = network.encryption;
                        
                        if (network.encryption === 'Open') {
                            securitySpan.className = 'badge warning';
                        } else {
                            securitySpan.className = 'badge success';
                        }
                        
                        securityCell.appendChild(securitySpan);
                        row.appendChild(securityCell);
                        
                        // –ö–∞–Ω–∞–ª
                        const channelCell = document.createElement('td');
                        channelCell.textContent = network.channel;
                        row.appendChild(channelCell);
                        
                        // –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                        const actionCell = document.createElement('td');
                        const connectBtn = document.createElement('button');
                        connectBtn.textContent = '–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è';
                        connectBtn.className = 'primary';
                        connectBtn.addEventListener('click', function() {
                            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–µ—Ç–∏
                            document.getElementById('ssid').value = network.ssid;
                            document.getElementById('password').focus();
                            
                            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Ñ–æ—Ä–º—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                            document.getElementById('connect-form').scrollIntoView({
                            behavior: 'smooth'
                            });
                        });
                        actionCell.appendChild(connectBtn);
                        row.appendChild(actionCell);
                        
                        networksList.appendChild(row);
                        });
                    } else {
                        networksList.innerHTML = '<tr><td colspan="5" class="text-center">–°–µ—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    scanButton.disabled = false;
                    scanStatus.style.display = 'none';
                    showNotification('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ WiFi —Å–µ—Ç–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'success');
                    })
                    .catch(error => {
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ—à–∏–±–∫—É
                    networksList.innerHTML = '<tr><td colspan="5" class="text-center">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</td></tr>';
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                    scanButton.disabled = false;
                    scanStatus.style.display = 'none';
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message, 'error');
                    });
            }            
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            function loadNetworkPage(page) {
                scanButton.disabled = true;
                scanStatus.style.display = 'block';
                scanStatusText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ' + (page + 1) + '...';
                
                networksList.innerHTML = '<tr><td colspan="5" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ' + (page + 1) + '...</td></tr>';
                
                fetch(`/scan-results?page=${page}&size=10`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                        }
                        return response.json();
                    })
                    .then(data => {
                        getNetworkResults();
                    })
                    .catch(error => {
                        networksList.innerHTML = '<tr><td colspan="5" class="text-center">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</td></tr>';
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', error);
                        scanButton.disabled = false;
                        scanStatus.style.display = 'none';
                        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ' + error.message, 'error');
                    });
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ç–∏
        function connectToNetwork() {
            const ssid = document.getElementById('ssid').value;
            const password = document.getElementById('password').value;
            
            if (!ssid) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ SSID —Å–µ—Ç–∏', 'warning');
                return;
            }
            
            showNotification(`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ ${ssid}...`, 'info');
            
            const formData = new FormData();
            formData.append('ssid', ssid);
            formData.append('password', password);
            
            fetch('/connect', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.text();
            })
            .then(result => {
                showNotification(`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ ${ssid} –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ`, 'success');
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('password').value = '';
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π
                setTimeout(() => {
                    loadSavedNetworks();
                    refreshStatus();
                }, 5000);
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ç–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ç–∏: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞
        function loadAPSettings() {
            fetch('/ap')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                })
                .then(data => {
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ AP
                    document.getElementById('ap-mode').value = data.mode;
                    document.getElementById('ap-ssid').value = data.ssid;
                    document.getElementById('ap-password').value = ''; // –ü–∞—Ä–æ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                    document.getElementById('ap-channel').value = data.channel;
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–∞–∑–¥–µ–ª honeypot –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–µ–∂–∏–º
                    const honeypotSection = document.getElementById('honeypot-section');
                    if (data.mode === 4) {
                        honeypotSection.style.display = 'block';
                        getHoneypotLogs();
                    } else {
                        honeypotSection.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ AP:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞: ' + error.message, 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞
        function updateAPSettings() {
            const formData = new FormData();
            formData.append('mode', document.getElementById('ap-mode').value);
            formData.append('ssid', document.getElementById('ap-ssid').value);
            formData.append('password', document.getElementById('ap-password').value);
            formData.append('channel', document.getElementById('ap-channel').value);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞...', 'info');
            
            fetch('/ap/config', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.text();
            })
            .then(result => {
                showNotification(result, 'success');
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                refreshStatus();
                loadAPSettings();
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ AP:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–æ–≤ honeypot
        function getHoneypotLogs() {
            fetch('/ap/honeypot/logs')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                })
                .then(data => {
                    const logsDiv = document.getElementById('honeypot-logs');
                    
                    if (data.logs && data.logs.length > 0) {
                        let logsHTML = '<table><tr><th>IP</th><th>–ü–æ—Ä—Ç</th><th>–í—Ä–µ–º—è</th><th>–î–∞–Ω–Ω—ã–µ</th></tr>';
                        
                        data.logs.forEach(log => {
                            const date = new Date(log.timestamp);
                            logsHTML += `<tr>
                                <td>${log.ip}</td>
                                <td>${log.port}</td>
                                <td>${date.toLocaleString()}</td>
                                <td>${log.data}</td>
                            </tr>`;
                        });
                        
                        logsHTML += '</table>';
                        logsDiv.innerHTML = logsHTML;
                    } else {
                        logsDiv.innerHTML = '<p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>';
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ª–æ–≥–æ–≤ honeypot:', error);
                    document.getElementById('honeypot-logs').innerHTML = '<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ª–æ–≥–æ–≤</p>';
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ª–æ–≥–æ–≤ Honeypot: ' + error.message, 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ KVM –ø–∏–Ω–æ–≤
        function loadKVMPins() {
            const pinsList = document.getElementById('pins-list');
            pinsList.innerHTML = '<p class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∏–Ω–æ–≤...</p>';
            
            fetch('/kvm')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                })
                .then(data => {
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                    document.getElementById('connection-check').value = data.connectionCheck;
                    
                    pinsList.innerHTML = '';
                    
                    if (data.pins && data.pins.length > 0) {
                        data.pins.forEach((pin, index) => {
                            const pinCard = document.createElement('div');
                            pinCard.className = 'pin-card';
                            
                            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∏–Ω–µ
                            const pinInfo = document.createElement('div');
                            pinInfo.className = 'pin-info';
                            pinInfo.innerHTML = `<strong>${pin.name}</strong><br>–ü–∏–Ω #${pin.pin}`;
                            pinCard.appendChild(pinInfo);
                            
                            // –†–µ–∂–∏–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
                            const monitorDiv = document.createElement('div');
                            monitorDiv.innerHTML = `
                                <label>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
                                    <select class="monitor-select" data-index="${index}">
                                        <option value="0" ${pin.monitorMode == 0 ? 'selected' : ''}>–í—ã–∫–ª</option>
                                        <option value="1" ${pin.monitorMode == 1 ? 'selected' : ''}>–í–∫–ª</option>
                                        <option value="2" ${pin.monitorMode == 2 ? 'selected' : ''}>–ó–≤—É–∫</option>
                                    </select>
                                </label>
                            `;
                            pinCard.appendChild(monitorDiv);
                            
                            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∏–Ω–∞
                            const pinState = document.createElement('div');
                            pinState.className = `pin-state ${pin.state ? 'on' : 'off'}`;
                            
                            // –ï—Å–ª–∏ —Ä–µ–∂–∏–º –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                            if (isPinInverted) {
                                pinState.textContent = pin.state ? '–í–´–ö–õ' : '–í–ö–õ';
                                pinState.className = `pin-state ${pin.state ? 'off' : 'on'}`;
                            } else {
                                pinState.textContent = pin.state ? '–í–ö–õ' : '–í–´–ö–õ';
                            }
                            
                            pinCard.appendChild(pinState);
                            
                            // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∏–Ω–æ–º
                            const pinControls = document.createElement('div');
                            pinControls.className = 'pin-controls';
                            
                            // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è
                            const toggleContainer = document.createElement('div');
                            toggleContainer.innerHTML = `
                                <label class="toggle-btn">
                                    <input type="checkbox" class="pin-toggle" data-index="${index}" ${pin.state ? 'checked' : ''}>
                                    <span class="slider"></span>
                                </label>
                            `;
                            pinControls.appendChild(toggleContainer);
                            
                            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–ø—É–ª—å—Å–æ–º
                            const pulseControl = document.createElement('div');
                            pulseControl.className = 'pulse-control';
                            pulseControl.innerHTML = `
                                <input type="number" id="pin-pulse-duration-${index}" 
                                       class="pulse-duration" 
                                       value="500" 
                                       min="50" 
                                       max="10000" 
                                       placeholder="–º—Å">
                                <button class="pulse-button" 
                                        onclick="sendPulseToPin(${index})"
                                        title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø—É–ª—å—Å">
                                    ‚ö° –ò–º–ø—É–ª—å—Å
                                </button>
                            `;
                            pinControls.appendChild(pulseControl);
                            
                            pinCard.appendChild(pinControls);
                            pinsList.appendChild(pinCard);
                        });
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π –∏ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤
                        document.querySelectorAll('.pin-toggle').forEach(toggle => {
                            toggle.addEventListener('change', function() {
                                const pinIndex = this.getAttribute('data-index');
                                togglePin(pinIndex);
                            });
                        });
                        
                        document.querySelectorAll('.monitor-select').forEach(select => {
                            select.addEventListener('change', function() {
                                const pinIndex = this.getAttribute('data-index');
                                changeMonitorMode(pinIndex, this.value);
                            });
                        });
                    } else {
                        pinsList.innerHTML = '<p class="text-center">–ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –ø–∏–Ω–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –ø–∏–Ω –Ω–∏–∂–µ.</p>';
                    }
                })
                .catch(error => {
                    pinsList.innerHTML = '<p class="text-center">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–∏–Ω–æ–≤</p>';
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ KVM –ø–∏–Ω–æ–≤:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ KVM –ø–∏–Ω–æ–≤: ' + error.message, 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∏–Ω–∞
        function changeMonitorMode(pinIndex, mode) {
            const formData = new FormData();
            formData.append('index', pinIndex);
            formData.append('monitor', mode);
            
            fetch('/kvm/pin', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.text();
            })
            .then(result => {
                // –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
                showNotification(`–†–µ–∂–∏–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∏–Ω–∞ ${parseInt(pinIndex) + 1} –∏–∑–º–µ–Ω–µ–Ω`, 'success');
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: ' + error.message, 'error');
                loadKVMPins(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–∏–Ω—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∏–Ω–∞
        function togglePin(pinIndex) {
            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const formData = new FormData();
            formData.append('index', pinIndex);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
            fetch('/kvm/pin', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.text();
            })
            .then(result => {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–∏–Ω–æ–≤
                showNotification(`–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∏–Ω–∞ ${parseInt(pinIndex) + 1} –∏–∑–º–µ–Ω–µ–Ω–æ`, 'success');
                loadKVMPins();
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –ø–∏–Ω–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –ø–∏–Ω–∞: ' + error.message, 'error');
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–∏–Ω–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                loadKVMPins();
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function updateConnectionCheck() {
            const interval = document.getElementById('connection-check').value;
            
            fetch('/kvm/connectioncheck', {
                method: 'POST',
                body: new URLSearchParams({
                    'interval': interval
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.text();
            })
            .then(result => {
                showNotification(result, 'success');
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–∏–Ω–∞
        function addNewPin() {
            const pinNumber = document.getElementById('pin-select').value;
            const pinName = document.getElementById('pin-name').value;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if (!pinNumber) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –ø–∏–Ω –∏–∑ —Å–ø–∏—Å–∫–∞', 'warning');
                return;
            }
            
            if (!pinName) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∏–Ω–∞', 'warning');
                return;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const formData = new FormData();
            formData.append('pin', pinNumber);
            formData.append('name', pinName);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
            fetch('/kvm/add', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
                return response.text();
            })
            .then(result => {
                showNotification(result, 'success');
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('pin-select').value = '';
                document.getElementById('pin-name').value = '';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–∏–Ω–æ–≤
                loadKVMPins();
                loadAvailablePins();
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–∏–Ω–∞:', error);
                showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
        function loadDeviceInfo() {
            const deviceDetails = document.getElementById('device-details');
            deviceDetails.innerHTML = '<p class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</p>';
            
            fetch('/diagnostic')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                })
                .then(data => {
                    let html = '<table>';
                    
                    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∂–µ–ª–µ–∑–µ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–∏
                    html += '<tr><th colspan="2">–ñ–µ–ª–µ–∑–æ</th></tr>';
                    html += `<tr><td>–ú–æ–¥–µ–ª—å</td><td>M5StickC PLUS2</td></tr>`;
                    html += `<tr><td>–ë–∞—Ç–∞—Ä–µ—è</td><td>${data.battery ? data.battery.toFixed(2) + 'V' : 'N/A'}</td></tr>`;
                    
                    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ WiFi
                    html += '<tr><th colspan="2">WiFi</th></tr>';
                    if (data.connected) {
                        html += `<tr><td>SSID</td><td>${data.ssid}</td></tr>`;
                        html += `<tr><td>–°–∏–≥–Ω–∞–ª</td><td>${data.rssi} dBm</td></tr>`;
                        html += `<tr><td>IP-–∞–¥—Ä–µ—Å</td><td>${data.ip}</td></tr>`;
                        html += `<tr><td>–ú–∞—Å–∫–∞ –ø–æ–¥—Å–µ—Ç–∏</td><td>${data.subnet}</td></tr>`;
                        html += `<tr><td>–®–ª—é–∑</td><td>${data.gateway}</td></tr>`;
                        html += `<tr><td>DNS</td><td>${data.dns}</td></tr>`;
                    } else {
                        html += `<tr><td colspan="2">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ WiFi</td></tr>`;
                    }
                    
                    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ—á–∫–µ –¥–æ—Å—Ç—É–ø–∞
                    html += '<tr><th colspan="2">–¢–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞</th></tr>';
                    if (data.ap_mode !== undefined && data.ap_mode > 0) {
                        let apModeName = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                        switch(data.ap_mode) {
                            case 1: apModeName = '–û–±—ã—á–Ω—ã–π'; break;
                            case 2: apModeName = '–†–µ—Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä'; break;
                            case 3: apModeName = '–°–∫—Ä—ã—Ç—ã–π'; break;
                            case 4: apModeName = 'Honeypot'; break;
                        }
                        
                        html += `<tr><td>–†–µ–∂–∏–º</td><td>${apModeName}</td></tr>`;
                        html += `<tr><td>SSID</td><td>${data.ap_ssid}</td></tr>`;
                        html += `<tr><td>IP-–∞–¥—Ä–µ—Å</td><td>${data.ap_ip}</td></tr>`;
                        html += `<tr><td>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</td><td>${data.ap_stations}</td></tr>`;
                    } else {
                        html += `<tr><td colspan="2">–¢–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞</td></tr>`;
                    }
                    
                    html += '</table>';
                    deviceDetails.innerHTML = html;
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:', error);
                    deviceDetails.innerHTML = '<p class="text-center">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>';
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ: ' + error.message, 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function loadDeviceSettings() {
            fetch('/device')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('brightness').value = data.brightness;
                    document.getElementById('brightness-value').textContent = data.brightness + '%';
                    
                    document.getElementById('sleep-timeout').value = data.sleepTimeout;
                    document.getElementById('device-id').value = data.deviceId;
                    document.getElementById('rotate-display').checked = data.rotateDisplay;
                    
                    document.getElementById('volume').value = data.volume;
                    document.getElementById('volume-value').textContent = data.volume + '%';
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ' + error.message, 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function saveDeviceSettings() {
            const formData = new FormData();
            formData.append('brightness', document.getElementById('brightness').value);
            formData.append('sleepTimeout', document.getElementById('sleep-timeout').value);
            formData.append('deviceId', document.getElementById('device-id').value);
            formData.append('rotateDisplay', document.getElementById('rotate-display').checked ? 1 : 0);
            formData.append('volume', document.getElementById('volume').value);
            
            fetch('/device/settings', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.text();
            })
            .then(result => {
                showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∑–≤—É–∫–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ "–ù–∞–π—Ç–∏ –º–µ–Ω—è"
        function findMe() {
            fetch('/device/findme', {
                method: 'POST'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.text();
            })
            .then(result => {
                showNotification('–ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', 'success');
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function resetDevice() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ?')) {
                fetch('/device/reset', {
                    method: 'POST'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.text();
                })
                .then(result => {
                    showNotification('–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...', 'info');
                    // –¢–∞–π–º–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                    setTimeout(() => {
                        window.location.reload();
                    }, 10000);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ' + error.message, 'error');
                });
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
        function checkNetworkTools() {
            if (!isAPModeActive) {
                document.getElementById('ip-block-section').style.display = 'none';
            } else {
                document.getElementById('ip-block-section').style.display = 'block';
                loadBlockedIPs();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö IP
        function loadBlockedIPs() {
            fetch('/network/blocked')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                })
                .then(data => {
                    const blockedIPsDiv = document.getElementById('blocked-ips');
                    
                    if (data.blocked && data.blocked.length > 0) {
                        let html = '<ul>';
                        data.blocked.forEach(ip => {
                            html += `<li>${ip} <button class="danger" onclick="unblockIP('${ip}')">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button></li>`;
                        });
                        html += '</ul>';
                        blockedIPsDiv.innerHTML = html;
                    } else {
                        blockedIPsDiv.innerHTML = '<p>–ù–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤</p>';
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö IP:', error);
                    document.getElementById('blocked-ips').innerHTML = '<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö IP</p>';
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Ping
        function pingHost() {
            const host = document.getElementById('ping-host').value;
            
            if (!host) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Å—Ç –¥–ª—è Ping', 'warning');
                return;
            }
            
            const resultDiv = document.getElementById('ping-result');
            resultDiv.innerHTML = '<div class="loader" style="display: block;"></div>';
            
            fetch('/network/ping', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `host=${encodeURIComponent(host)}`
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.json();
            })
            .then(data => {
                let resultHTML = '<div class="status info">';
                
                if (data.success) {
                    resultHTML += `<p>Ping –∫ ${host} —É—Å–ø–µ—à–µ–Ω</p>`;
                    resultHTML += `<p>IP: ${data.ip}</p>`;
                    resultHTML += `<p>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: ${data.time} –º—Å</p>`;
                    resultHTML += `<p>–ü–æ—Ç–µ—Ä—è –ø–∞–∫–µ—Ç–æ–≤: ${data.loss}%</p>`;
                } else {
                    resultHTML += `<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ ping –∫ ${host}</p>`;
                    if (data.error) {
                        resultHTML += `<p>–û—à–∏–±–∫–∞: ${data.error}</p>`;
                    }
                }
                
                resultHTML += '</div>';
                resultDiv.innerHTML = resultHTML;
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ ping:', error);
                resultDiv.innerHTML = `
                    <div class="status error">
                        <p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ ping: ${error.message}</p>
                    </div>
                `;
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ IP
        function scanIPRange() {
            const prefix = document.getElementById('ip-prefix').value;
            
            if (!prefix) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å —Å–µ—Ç–∏ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                return;
            }
            
            const progressDiv = document.getElementById('ip-scan-progress');
            const progressBar = document.getElementById('ip-scan-progress-bar');
            const progressStatus = document.getElementById('ip-scan-status');
            const resultDiv = document.getElementById('ip-scan-result');
            
            progressDiv.style.display = 'block';
            resultDiv.innerHTML = '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...';
            
            let currentIP = 1;
            const totalIPs = 254;
            const results = [];
            
            function scanNext() {
                if (currentIP > totalIPs) {
                    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                    progressDiv.style.display = 'none';
                    displayScanResults(results);
                    return;
                }
                
                const progress = (currentIP / totalIPs) * 100;
                progressBar.style.width = `${progress}%`;
                progressStatus.textContent = `–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: ${currentIP}/${totalIPs}`;
                
                // –°–∫–∞–Ω–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π IP
                fetch('/network/scan-single', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `ip=${encodeURIComponent(prefix + '.' + currentIP)}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.active) {
                        results.push({
                            ip: prefix + '.' + currentIP,
                            active: true,
                            time: data.time
                        });
                    }
                    currentIP++;
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É IP
                    setTimeout(scanNext, 100); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ IP:', error);
                    currentIP++;
                    setTimeout(scanNext, 100);
                });
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            scanNext();
        }
        
        function displayScanResults(results) {
            const resultDiv = document.getElementById('ip-scan-result');
            let resultHTML = '';
            
            if (results.length > 0) {
                resultHTML = '<table><tr><th>IP-–∞–¥—Ä–µ—Å</th><th>–°—Ç–∞—Ç—É—Å</th><th>–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞</th></tr>';
                
                results.forEach(host => {
                    resultHTML += `<tr>
                        <td>${host.ip}</td>
                        <td><span class="badge success">–ê–∫—Ç–∏–≤–µ–Ω</span></td>
                        <td>${host.time ? host.time + ' –º—Å' : '-'}</td>
                    </tr>`;
                });
                
                resultHTML += '</table>';
            } else {
                resultHTML = '<div class="status warning"><p>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ö–æ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p></div>';
            }
            
            resultDiv.innerHTML = resultHTML;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Ä—Ç–æ–≤
        function scanPorts() {
            const ip = document.getElementById('port-scan-ip').value;
            const startPort = document.getElementById('port-scan-start').value;
            const endPort = document.getElementById('port-scan-end').value;
            
            if (!ip) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ IP-–∞–¥—Ä–µ—Å –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Ä—Ç–æ–≤', 'warning');
                return;
            }
            
            const resultDiv = document.getElementById('port-scan-result');
            resultDiv.innerHTML = '<div class="loader" style="display: block;"></div>';
            
            fetch('/network/portscan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `ip=${encodeURIComponent(ip)}&startPort=${startPort}&endPort=${endPort}`
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.json();
            })
            .then(data => {
                let resultHTML = '';
                
                if (data.success) {
                    if (data.ports && data.ports.length > 0) {
                        resultHTML = `<div class="status success"><p>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –¥–ª—è ${ip} –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –ù–∞–π–¥–µ–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤: ${data.ports.length}</p></div>`;
                        resultHTML += '<table><tr><th>–ü–æ—Ä—Ç</th><th>–°—Ç–∞—Ç—É—Å</th><th>–°–µ—Ä–≤–∏—Å</th></tr>';
                        
                        data.ports.forEach(port => {
                            resultHTML += `<tr>
                                <td>${port.port}</td>
                                <td><span class="badge success">–û—Ç–∫—Ä—ã—Ç</span></td>
                                <td>${port.service || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</td>
                            </tr>`;
                        });
                        
                        resultHTML += '</table>';
                    } else {
                        resultHTML = `<div class="status warning"><p>–û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è ${ip}</p></div>`;
                    }
                } else {
                    resultHTML = `<div class="status error"><p>–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ—Ä—Ç–æ–≤: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p></div>`;
                }
                
                resultDiv.innerHTML = resultHTML;
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ—Ä—Ç–æ–≤:', error);
                resultDiv.innerHTML = `
                    <div class="status error">
                        <p>–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ—Ä—Ç–æ–≤: ${error.message}</p>
                    </div>
                `;
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IP
        function blockIP() {
            const ip = document.getElementById('block-ip').value;
            
            if (!ip) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ IP-–∞–¥—Ä–µ—Å –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏', 'warning');
                return;
            }
            
            if (!isAPModeActive) {
                showNotification('–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞', 'warning');
                return;
            }
            
            fetch('/network/block', {
                method: 'POST',
                body: new URLSearchParams({
                    'ip': ip
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.text();
            })
            .then(result => {
                showNotification(`IP-–∞–¥—Ä–µ—Å ${ip} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`, 'success');
                loadBlockedIPs();
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ IP:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ IP: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IP
        function unblockIP(ip) {
            if (!isAPModeActive) {
                showNotification('–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞', 'warning');
                return;
            }
            
            fetch('/network/unblock', {
                method: 'POST',
                body: new URLSearchParams({
                    'ip': ip
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.text();
            })
            .then(result => {
                showNotification(`IP-–∞–¥—Ä–µ—Å ${ip} —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`, 'success');
                loadBlockedIPs();
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ IP:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ IP: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π AP
        function loadAPUsers() {
            const usersList = document.getElementById('ap-users-list');
            
            if (!isAPModeActive) {
                usersList.innerHTML = '<p class="text-center">–¢–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞</p>';
                return;
            }
            
            usersList.innerHTML = '<p class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>';
            
            fetch('/ap/users')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.users && data.users.length > 0) {
                        let html = '';
                        
                        data.users.forEach(user => {
                            html += `
                                <div class="ap-user-card" id="user-${user.ip.replace(/\./g, '-')}">
                                    <div class="ap-user-info">
                                        <h4>${user.ip}</h4>
                                        <div>MAC: ${user.mac}</div>
                                        <div>–û–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫: ${user.totalBytes} –±–∞–π—Ç</div>
                                        <div>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${new Date(user.lastSeen).toLocaleString()}</div>
                                    </div>
                                    <div class="ap-user-controls">
                                        <button class="primary" onclick="showUserDetails('${user.ip}')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                                        <button class="${user.blocked ? 'success' : 'danger'}" 
                                                onclick="toggleUserBlock('${user.ip}', ${!user.blocked})">
                                            ${user.blocked ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}
                                        </button>
                                    </div>
                                </div>
                                <div id="user-details-${user.ip.replace(/\./g, '-')}" class="user-details-section hidden">
                                    <div>
                                        <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
                                        <table>
                                            <tr><td>IP:</td><td>${user.ip}</td></tr>
                                            <tr><td>MAC:</td><td>${user.mac}</td></tr>
                                            <tr><td>–û–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:</td><td>${user.totalBytes} –±–∞–π—Ç</td></tr>
                                            <tr><td>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</td><td>${new Date(user.lastSeen).toLocaleString()}</td></tr>
                                            <tr><td>–°—Ç–∞—Ç—É—Å:</td><td>${user.blocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–ê–∫—Ç–∏–≤–µ–Ω'}</td></tr>
                                        </table>
                                    </div>
                                    <div>
                                        <h5>–¢—Ä–∞—Ñ–∏–∫</h5>
                                        <button class="primary" onclick="startSniffing('${user.ip}')">–ù–∞—á–∞—Ç—å —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥</button>
                                        <button class="danger" onclick="stopSniffing()">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥</button>
                                        <div id="traffic-display-${user.ip.replace(/\./g, '-')}" class="traffic-display"></div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        usersList.innerHTML = html;
                    } else {
                        usersList.innerHTML = '<p class="text-center">–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>';
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                    usersList.innerHTML = '<p class="text-center">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>';
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ' + error.message, 'error');
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function showUserDetails(ip) {
            const detailsDiv = document.getElementById(`user-details-${ip.replace(/\./g, '-')}`);
            if (detailsDiv) {
                detailsDiv.classList.toggle('hidden');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function toggleUserBlock(ip, block) {
            fetch('/ap/users/block', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `ip=${encodeURIComponent(ip)}&blocked=${block ? 1 : 0}`
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    showNotification(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${ip} ${block ? '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'}`, 'success');
                    loadAPUsers();
                } else {
                    showNotification(`–û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—á–∞–ª–∞ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞
        function startSniffing(ip) {
            currentUserIP = ip;
            const trafficDisplay = document.getElementById(`traffic-display-${ip.replace(/\./g, '-')}`);
            
            if (trafficDisplay) {
                trafficDisplay.innerHTML = '<p>–ó–∞–ø—É—Å–∫ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞...</p>';
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–ø—É—Å–∫ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞
            fetch('/ap/users/sniff', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `ip=${encodeURIComponent(ip)}&action=start`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('–°–Ω–∏—Ñ—Ñ–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω', 'success');
                    // –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞
                    sniffInterval = setInterval(() => {
                        fetch(`/ap/users/traffic?ip=${encodeURIComponent(ip)}`)
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                                }
                                return response.json();
                            })
                            .then(data => {
                                if (trafficDisplay) {
                                    let displayHtml = `
                                        <div><strong>–û–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫:</strong> ${data.totalBytes} –±–∞–π—Ç</div>
                                        <div><strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–∞–∫–µ—Ç:</strong> ${data.lastPacket || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</div>
                                        <div><strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> ${new Date().toLocaleTimeString()}</div>
                                    `;
                                    
                                    if (data.sniffing && data.lastPacketInfo) {
                                        displayHtml += `
                                            <div class="divider"></div>
                                            <div><strong>–°–Ω–∏—Ñ—Ñ–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω</strong></div>
                                            <div><strong>–ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ –ø–∞–∫–µ—Ç–æ–≤:</strong> ${data.sniffedPackets}</div>
                                            <div><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–∫–µ—Ç–µ:</strong> ${data.lastPacketInfo}</div>
                                        `;
                                    }
                                    
                                    trafficDisplay.innerHTML = displayHtml;
                                }
                            })
                            .catch(error => {
                                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞:', error);
                                if (sniffInterval) {
                                    clearInterval(sniffInterval);
                                    sniffInterval = null;
                                }
                                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞: ' + error.message, 'error');
                            });
                    }, 1000); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                } else {
                    showNotification(`–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞: ' + error.message, 'error');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞ —Ç—Ä–∞—Ñ–∏–∫–∞
        function stopSniffing() {
            if (sniffInterval) {
                clearInterval(sniffInterval);
                sniffInterval = null;
            }
            
            if (currentUserIP) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫—É —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞
                fetch('/ap/users/sniff', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `ip=${encodeURIComponent(currentUserIP)}&action=stop`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('–°–Ω–∏—Ñ—Ñ–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'success');
                        const trafficDisplay = document.getElementById(`traffic-display-${currentUserIP.replace(/\./g, '-')}`);
                        if (trafficDisplay) {
                            trafficDisplay.innerHTML = '<p>–°–Ω–∏—Ñ—Ñ–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</p>';
                        }
                    } else {
                        showNotification(`–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞: ${data.error}`, 'error');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–Ω–∏—Ñ—Ñ–∏–Ω–≥–∞: ' + error.message, 'error');
                });
                
                currentUserIP = null;
            }
        }
    </script>
</body>
</html>